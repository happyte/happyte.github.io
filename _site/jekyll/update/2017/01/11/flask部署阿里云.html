<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>flask部署到阿里云</title> <meta name="description" content="利用阿里云，把flask web程序部署到上面"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://localhost:4000/jekyll/update/2017/01/11/flask%E9%83%A8%E7%BD%B2%E9%98%BF%E9%87%8C%E4%BA%91.html"> <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="primary-nav"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="https://github.com/happyte" ><i class="icon icon-github"></i> Github</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">flask部署到阿里云</h1> <p class="post-meta"><time datetime="2017-01-11T10:30:00+08:00" itemprop="datePublished">Jan 11, 2017</time></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <ul> <li> <p>1.上周入手了阿里云，所以把前段时间写的flask程序部署到阿里云上，之前是部署到heroku上的，下面介绍下如何部署到阿里云上。</p> </li> <li> <p>2.阿里云部署后的链接为:<a href="http://123.57.132.125">http://123.57.132.125</a>, 欢迎大家使用。</p> </li> <li> <p>3.把flask工程中的文件通过scp命令拷贝到阿里云下，我的工程下的app包、migrations包、config.py、manager.py和requirements.txt通过命令例如<code class="highlighter-rouge">scp -r xxx(需要拷贝的文件) root@xxxxxx(阿里云ip):/(你希望安装的目录)</code>。</p> </li> <li> <p>4.来到拷贝到的阿里云目录下，建立虚拟坏境<code class="highlighter-rouge">virtualenv venv</code> ,激活虚拟坏境<code class="highlighter-rouge">. venv/bin/activate</code>。安装工程所有需要模块<code class="highlighter-rouge">pip install -r requirements.txt</code>。</p> </li> <li> <p>5.在阿里云的/etc/init目录下新建一个配置文件例如<code class="highlighter-rouge">sudo nano /etc/init/blog.conf</code>,该文件可以在虚拟机打开时自动执行flask web程序，在该文件内写入:</p> </li> </ul> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="n">description</span> <span class="s">"My Blog service"</span>

<span class="n">start</span> <span class="n">on</span> <span class="n">runlevel</span> <span class="p">[</span><span class="mi">2345</span><span class="p">]</span>
<span class="n">stop</span> <span class="n">on</span> <span class="n">runlevel</span> <span class="p">[</span><span class="o">!</span><span class="mi">2345</span><span class="p">]</span>

<span class="n">respawn</span>
<span class="n">setuid</span> <span class="n">root</span>
<span class="n">setgid</span> <span class="n">www</span><span class="o">-</span><span class="n">data</span>

<span class="n">env</span> <span class="n">PATH</span><span class="o">=/</span><span class="n">root</span><span class="o">/</span><span class="n">flask</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="n">bin</span>  <span class="err">#</span> <span class="err">坏境的路径</span>
<span class="n">chdir</span> <span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="n">flask</span><span class="o">/</span>             <span class="err">#</span> <span class="err">工作目录</span> 

<span class="n">exec</span> <span class="n">gunicorn</span> <span class="o">-</span><span class="n">w</span> <span class="mi">4</span> <span class="o">-</span><span class="n">b</span> <span class="mi">127</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="mi">1</span><span class="o">:</span><span class="mi">8000</span> <span class="n">manager</span><span class="o">:</span><span class="n">app</span> <span class="err">#</span> <span class="err">启动</span><span class="n">web</span><span class="err">服务器</span>
</code></pre></div> <ul> <li> <p>6.启动blog.conf,输入命令<code class="highlighter-rouge">sudo service blog start</code>,查看是否启动成功。</p> </li> <li> <p>7.配置nginx反向代理服务器，如果阿里云没有安装nginx，用<code class="highlighter-rouge">apt-get install nginx</code> 命令安装下，修改/etc/nginx/site-available/default文件，修改如下:</p> </li> </ul> <div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="cp"># /ect/nginx/sites-available/default
</span>
<span class="n">server</span> <span class="p">{</span>
    <span class="n">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="n">server_name</span> <span class="mi">10</span><span class="p">.</span><span class="mi">211</span><span class="p">.</span><span class="mi">55</span><span class="p">.</span><span class="mi">10</span><span class="p">;</span>

    <span class="n">location</span> <span class="o">/</span> <span class="p">{</span>
        <span class="n">proxy_pass</span> <span class="n">http</span><span class="o">:</span><span class="c1">//127.0.0.1:8000;
</span>        <span class="n">proxy_set_header</span> <span class="n">Host</span> <span class="err">$</span><span class="n">host</span><span class="p">;</span>
        <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">For</span> <span class="err">$</span><span class="n">proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
</code></pre></div> <ul> <li> <p>8.重新启动nginx,输入命令<code class="highlighter-rouge">sudo service nginx restart</code>。</p> </li> <li> <p>9.安装postgresql，<code class="highlighter-rouge">apt-get install postresql</code>，创建数据库输入命令<code class="highlighter-rouge">createdb blogdb</code>。</p> </li> <li> <p>10.以上步骤都成功的话就可以部署你的flask程序了。</p> </li> </ul> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/answershuto" target="_blank"><i class="icon icon-github"></i></a></li> </ul> <p> <br><small>&copy;2017 ZhangShu , All rights reserved.</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html><!-- by nandomoreira.me -->