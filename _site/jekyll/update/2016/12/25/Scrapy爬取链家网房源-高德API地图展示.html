<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>高德地图API展示Scrapy爬取的链家网房源</title> <meta name="description" content="Scrapy爬取成都链接网房源，利用高德API展示"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="http://localhost:4000/jekyll/update/2016/12/25/Scrapy%E7%88%AC%E5%8F%96%E9%93%BE%E5%AE%B6%E7%BD%91%E6%88%BF%E6%BA%90-%E9%AB%98%E5%BE%B7API%E5%9C%B0%E5%9B%BE%E5%B1%95%E7%A4%BA.html"> <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml"> <script src="/assets/js/modernizr.js"></script> </head> <body"> <main class="wrapper"> <header class="site-header"> <a href="#navbar" id="menu-burger" class="menu-burger">Menu <span class="nav-icon"></span> <svg x="0px" y="0px" width="54px" height="54px" viewBox="0 0 54 54"> <circle fill="transparent" stroke="#000000" stroke-width="1" cx="27" cy="27" r="25" stroke-dasharray="157 157" stroke-dashoffset="157"></circle> </svg> </a> <div id="navbar" class="navbar"> <div class="navigation-wrapper"> <div class="half-block"> <h2>Navigation</h2> <nav> <ul class="primary-nav"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about">About</a></li> <li><a href="https://github.com/happyte" ><i class="icon icon-github"></i> Github</a></li> </ul> </nav> </div> </div> </div> </header> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header intro"> <div class="intro-in"> <h1 class="post-title" itemprop="name headline">高德地图API展示Scrapy爬取的链家网房源</h1> <p class="post-meta"><time datetime="2016-12-25T10:52:00+08:00" itemprop="datePublished">Dec 25, 2016</time></p> </div> </header> <div class="post-content container" itemprop="articleBody"> <h2 id="1代码链接">1.代码链接</h2> <p><a href="https://github.com/happyte/buyhouse">https://github.com/happyte/buyhouse</a></p> <h2 id="2最终效果图">2.最终效果图</h2> <p><img src="/img/Scrapy/1.png" alt="img" /></p> <p><img src="/img/Scrapy/2.png" alt="img" /></p> <p><img src="/img/Scrapy/3.png" alt="img" /></p> <p><img src="/img/Scrapy/4.png" alt="img" /></p> <h2 id="3实现思路">3.实现思路</h2> <ul> <li> <p>1.爬取的是链家网的成都地区的新房源，爬出房源的名字、价格、地址和url这四个。我是基于python的scrapy实现爬虫的。</p> </li> <li> <p>2.在终端安装scrapy,使用命令pip install scrapy,安装完后新建项目scrapy startproject fangjia。</p> </li> <li> <p>3.明确需要爬取的数据，在items.py文件中写入需要爬取的数据。在scrapy中，Item是用来抓取内容的容器，类似python中的字典</p> </li> </ul> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">scrapy</span>

<span class="k">class</span> <span class="nc">FangjiaItem</span><span class="p">(</span><span class="n">scrapy</span><span class="o">.</span><span class="n">Item</span><span class="p">):</span>
    <span class="n">FANGJIA_ADDRESS</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>    <span class="c"># 住房地址</span>
    <span class="n">FANGJIA_NAME</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>       <span class="c"># 名字</span>
    <span class="n">FANGJIA_PRICE</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>      <span class="c"># 房价</span>
    <span class="n">FANGJIA_URL</span> <span class="o">=</span> <span class="n">scrapy</span><span class="o">.</span><span class="n">Field</span><span class="p">()</span>        <span class="c"># 房源url</span>
</code></pre></div> <ul> <li>4.下面分析下网页，来到成都房源的首页，一共有19个分页，分页的url例如http://cd.fang.lianjia.com/loupan/nht1/，最后一个数字代表页数。查看网页源代码如下:</li> </ul> <p><img src="http://img.blog.csdn.net/20161227205350218?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMDc0NTMyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" /> 可以直接在该网页抓取我们想要的房名、地址、价格和url。我的方法是先抓取url,再进入具体网页抓取想要的数据。从上图可以看到a标签的<code class="highlighter-rouge">href="/loupan/p_chaygceqaausi/"</code> 即为我们想要的相对路径，拼接<code class="highlighter-rouge">http://cd.fang.lianjia.com</code> 成<code class="highlighter-rouge">http://cd.fang.lianjia.com/loupan/p_chaygceqaausi/</code> 即为我们需要的url。</p> <ul> <li> <p>5.使用xpath抓取上面的a标签中的href，<code class="highlighter-rouge">fang_links = response.xpath('//div[@class="list-wrap"]/ul[@id="house-lst"]/li/div[@class="pic-panel"]/a/@href').extract()</code> 抓取一个页面的所有的url集合，遍历上面的集合，请求具体页面。</p> </li> <li> <p>6.来到一个具体页面分析，抓取我们要的数据标签位置</p> </li> <li> <p>房源名字 <img src="http://img.blog.csdn.net/20161227210346122?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMDc0NTMyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" /></p> </li> <li> <p>房源单价 <img src="http://img.blog.csdn.net/20161227210857794?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMDc0NTMyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" /></p> </li> <li> <p>房源地址 <img src="http://img.blog.csdn.net/20161227210937160?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMDc0NTMyNA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述" /></p> </li> </ul> <p>抓取的代码如下:</p> <div class="language-python highlighter-rouge"><pre class="highlight"><code> <span class="n">name</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="name-box"]/a/@title'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//div[@class="name-box"]/a/@href'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">price</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//p[@class="jiage"]/span[@class="junjia"]/text()'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">'//p[@class="where"]/span/@title'</span><span class="p">)</span><span class="o">.</span><span class="n">extract</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div> <ul> <li>7.把上面抓取的数据放入item中，创建一个items.py定义的FangjiaItem类对象，最终输出这个对象item</li> </ul> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">item</span><span class="p">[</span><span class="s">'FANGJIA_NAME'</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
<span class="n">item</span><span class="p">[</span><span class="s">'FANGJIA_ADDRESS'</span><span class="p">]</span> <span class="o">=</span> <span class="n">address</span>
<span class="n">item</span><span class="p">[</span><span class="s">'FANGJIA_PRICE'</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span>
<span class="n">item</span><span class="p">[</span><span class="s">'FANGJIA_URL'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'http://cd.fang.lianjia.com'</span><span class="o">+</span><span class="n">url</span>
<span class="k">yield</span> <span class="n">item</span>
</code></pre></div> <ul> <li>8.在scrapy工程的settings.py文件中要设置如下代码:</li> </ul> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">ITEM_PIPELINES</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">'fangjia.pipelines.FangjiaPipeline'</span><span class="p">:</span><span class="mi">300</span>
<span class="p">}</span>
</code></pre></div> <h2 id="高德地图api调用">高德地图API调用</h2> <p>采用高德地图对房源进行可视化操作，在工程根目录下创建demo.html文件，页面大框架可直接从示例中心复制：高德 JavaScript API 示例中心<a href="http://lbs.amap.com/api/javascript-api/example/map/map-show/">http://lbs.amap.com/api/javascript-api/example/map/map-show/</a>。具体可以看我仓库中的demo.html文件。</p> </div> </article> <footer class="site-footer"> <div class="container"> <ul class="social"> <li><a href="http://github.com/answershuto" target="_blank"><i class="icon icon-github"></i></a></li> </ul> <p> <br><small>&copy;2017 ZhangShu , All rights reserved.</small> </p> </div> </footer> </main> <script src="/assets/js/jquery-2.1.1.js"></script> <script src="/assets/js/main.js"></script> </body> </html><!-- by nandomoreira.me -->